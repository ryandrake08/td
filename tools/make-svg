#!/bin/bash

# NOTE: Requires packages pdf2svg and xmlstarlet

# Function to convert a single PDF to SVG template icon
convert_pdf_to_svg() {
    local filename="$1"
    local pdf_file="Art/${filename}.pdf"
    local svg_file="Resources/${filename}.svg"

    # Convert PDF to SVG
    if ! pdf2svg "$pdf_file" "$svg_file"; then
        echo "Error: Failed to convert $pdf_file"
        return 1
    fi

    # Special case for b_new: remove defs and g elements first
    if [[ "$filename" == "b_new" ]]; then
        xmlstarlet ed -P -L -N x="http://www.w3.org/2000/svg" -d //x:defs -d //x:g "$svg_file"
    fi

    # Convert stroke colors to black for template icon compatibility (skip for i_chip)
    if [[ "$filename" != "i_chip" ]]; then
        xmlstarlet ed -P -L -N x="http://www.w3.org/2000/svg" \
            -u "//x:path[@stroke][starts-with(@stroke, 'rgb(')]/@stroke" \
            -v "rgb(0%, 0%, 0%)" \
            "$svg_file"
    fi
}

# Array of PDF filenames (without .pdf extension)
pdf_files=(
    "b_auth"
    "b_call_clock"
    "b_configure"
    "b_display"
    "b_export"
    "b_move"
    "b_new"
    "b_next"
    "b_note_dollar"
    "b_note_euro"
    "b_note_rupee"
    "b_note_sterling"
    "b_note_yen_yuan"
    "b_play_pause"
    "b_previous"
    "b_rebalance"
    "b_restart"
    "b_rocket"
    "b_seat"
    "b_seating"
    "b_stop"
    "b_table"
    "i_chip"
    "m_addon"
    "m_buyin"
    "m_rebuy"
    "t_chips"
    "t_clock"
    "t_connect"
    "t_devices"
    "t_funding"
    "t_payouts"
    "t_players"
    "t_results"
    "t_rounds"
)

# Convert all PDF files to template SVG icons
for filename in "${pdf_files[@]}"; do
    convert_pdf_to_svg "$filename"
done